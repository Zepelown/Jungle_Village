<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>íšŒì› ê°€ì…</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            display: flex;
         justify-content: center;
            align-items: center;
        }

        .main_panel {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            width: 100%;
        }

        .sign_up_panel {
             display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
             border: 1px solid #ccc;
             border-radius: 10px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
             background-color: #fff;
        }

        .logo_img{
            width: 300px;
            height: 200px;
        }
        .logo_title{
            width: 300px;
            text-align: center;
            font-size: larger;
            font-weight: bolder;
        }
        .header_font{
            font-weight: bold;
            width: 300px;
            display: flex;
            justify-content: space-between; 
            align-items: center; 
        }
        .input_size{
            width: 250px;
        }
        .toggle_button {
            right: 10px;
            top: 50%;
            transform: translateY(-10%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }
    </style>
    <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
    integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
    crossorigin="anonymous"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function validatePassword(password) {
            const regex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d\W]{4,12}$/;
            return regex.test(password);
        }

        function get_otp(){
            let email_check = $('#checkbox_email').text();
            if(email_check === 'âŒ'){
                alert('ì¤‘ë³µ ë©”ì¼ ì²´í¬ë¶€í„° í•´ì£¼ì„¸ìš”!');
            }
            else{
                $.ajax({
                type: "POST",
                url: "/auth/send_otp",
                data: { user_email: $('#user_email').val() },
                success: function (response) {
                    alert(response['message']);
                }
             })
            }
        }

        function verify_otp(){
            $.ajax({
                type: "POST",
                url: "/auth/verify_otp",
                data: { user_email: $('#user_email').val(), user_otp: $('#otp_code').val()},
                success: function (response) {
                    alert(response['message']);
                    if(response['check'] === "true"){
                        $('#checkbox_otp').text("âœ…")
                    }
                    else{
                        $('#checkbox_otp').text("âŒ")
                    }
                }
             })
        }

        function check_email(){
            let email = $('#user_email').val();

            if (!email) {
                alert("ì´ë©”ì¼ì„ í™•ì¸í•˜ì„¸ìš”!");
                return;
            }

            $.ajax({
                type: "POST",
                url: "/auth/check_email",
                data: { user_email: email },
                success: function (response) {
                    alert(response['message']);
                    let check = response['check']
                    if(check === 'true'){
                        $("#checkbox_email").text("âœ…");
                        if ($("#otp_input_container").length === 0) {
                            let temp_html = `
                                <div id="otp_input_container">
                                    <p class="header_font"><span>ì¸ì¦ë²ˆí˜¸</span><button class="btn btn-link"onclick="get_otp()">ì¸ì¦ë²ˆí˜¸ ë°›ê¸°</button></p>
                                    <p>
                                    <input class="input_size" id="otp_code" type="text" placeholder="ì¸ì¦ë²ˆí˜¸ ì…ë ¥">
                                    <span id="checkbox_otp">âŒ</span>
                                    </p>
                                    <div style="display: flex; justify-content: flex-end;">
                                        <button class="btn btn-link" onclick="verify_otp()">ì¸ì¦ë²ˆí˜¸ í™•ì¸</button>
                                    </div>
                                </div>
                            `;
                    $(temp_html).insertAfter("#email_container");
                }
                    }
                    else{
                        $("#checkbox_email").text("âŒ");
                    }
                }
            })

        }

        function check_nickname(){
            let nickname = $('#user_nickname').val();
            if (!nickname) {
                alert("ë‹‰ë„¤ì„ì„ í™•ì¸í•˜ì„¸ìš”!");
                return;
            }

            $.ajax({
                type: "POST",
                url: "/auth/check_nickname",
                data: { user_nickname: nickname },
                success: function (response) {
                    alert(response['message']);
                    let check = response['check']
                    if(check === 'true'){
                        $("#checkbox_nickname").text("âœ…");
                    }
                    else{
                        $("#checkbox_nickname").text("âŒ");
                    }
                }
            })
        }

        function complete_sign_up(){
            let email = $('#user_email').val();
            let password = $('#user_password').val();
            let nickname = $('#user_nickname').val();
            let generation = $('#user_generation').val();

            if(!email || !password || !nickname || !generation){
                alert('ì…ë ¥í•˜ì§€ ì•Šì€ ì •ë³´ê°€ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            let check1 = $('#checkbox_email').text();
            let check2 = $('#checkbox_nickname').text();
            let check3 = $('#checkbox_otp').text();

            if(check1 === "âŒ" || check2 === "âŒ" || check3 === "âŒ"){
                alert('ì¤‘ë³µ ì´ë©”ì¼ ë˜ëŠ” ì¤‘ë³µ ë‹‰ë„¤ì„ ë˜ëŠ” ì¸ì¦ì‹¤íŒ¨ ì…ë‹ˆë‹¤.');
                return;
            }

            $.ajax({
                type: "POST",
                url: "/auth/complete_sign_up",
                data: { user_email: email, user_password: password, user_nickname: nickname, user_generation: generation},
                success: function (response) {
                    alert(response['result']);
                    window.location.href = "/auth/log_in"; 

                }
            })
           
        }

        function toggle_password() {
                const password_input = document.getElementById("user_password");
                 if (password_input.type === "password") {
                     password_input.type = "text";  // ë¹„ë°€ë²ˆí˜¸ ë³´ì´ê¸°
                } else {
                    password_input.type = "password"; // ë¹„ë°€ë²ˆí˜¸ ìˆ¨ê¸°ê¸°
                }
        }
    </script>
</head>
<body>
    <div class="main_panel">
        <div class="sign_up_panel">
            <div class="sign_up_title">
                <p><img class="logo_img" src="../static/logo.png"></p>
                <p class="logo_title">ì •ê¸€ë§ˆì„</p>
            </div>
            <div class="sign_up_format">
                <div id="email_container">
                    <p class="header_font"><span>ì´ë©”ì¼</span><button class="btn btn-link" onclick="check_email()">ì¤‘ë³µí™•ì¸</button></p>
                    <p>
                      <input class="input_size" id="user_email" type="text"><span id="checkbox_email">âŒ</span>
                    </p>
                </div>
                <p class="header_font">ë¹„ë°€ë²ˆí˜¸</p>
                <p>
                    <input class="input_size" id="user_password" type="password">
                    <button class="toggle_button" onclick="toggle_password()">ğŸ‘ï¸</button>
                </p>
                <p class="header_font"><span>ë‹‰ë„¤ì„</span><button class="btn btn-link" onclick="check_nickname()">ì¤‘ë³µí™•ì¸</button></p>
                <p>
                    <input class="input_size" id="user_nickname" type="text"><span id="checkbox_nickname">âŒ</span>
                </p>
                <p class="header_font">í¬ë˜í”„í†¤ ì •ê¸€ ê¸°ìˆ˜</p>
                <p>
                    <select class="form-select" aria-label="Default select example" id="user_generation">
                        <option value="">ê¸°ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="1">1ê¸°</option>
                        <option value="2">2ê¸°</option>
                        <option value="3">3ê¸°</option>
                        <option value="4">4ê¸°</option>
                        <option value="5">5ê¸°</option>
                        <option value="6">6ê¸°</option>
                        <option value="7">7ê¸°</option>
                        <option value="8">8ê¸°</option>
                    </select>
                </p>
                <p><button class="btn btn-link" id="btn_submit" type="submit" onclick="complete_sign_up()">ì œì¶œí•˜ê¸°</button></p>
                
            </div>
        </div>
    </div>
</body>
</html>
